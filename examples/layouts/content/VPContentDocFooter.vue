<script lang="ts">
import { defineComponent, computed } from "@vue/composition-api";
import { useData } from "@examples/composables/config";
import VCVIconChevronLeft from "@examples/components/icons/VCVIconChevronLeft.vue";
import VCVIconChevronRight from "@examples/components/icons/VCVIconChevronRight.vue";

import { getSidebar } from "@examples/utils/sidebar";
import { isActive, normalizeLink } from "@examples/utils/utils";

import { MenuItemWithLink } from "@examples/types/menu";
import { SidebarGroup } from "@examples/types/config";

export default defineComponent({
  components: {
    VCVIconChevronLeft,
    VCVIconChevronRight,
  },
  setup() {
    const { page, theme } = useData();

    const links = computed(() => {
      const sidebar = getSidebar(theme.sidebar, page.relativePath);
      const candidates = getFlatSideBarLinks(sidebar);
      const index = candidates.findIndex((link) =>
        isActive(page.relativePath, link.link)
      );
      return {
        prev: candidates[index - 1],
        next: candidates[index + 1],
      };
    });

    function getFlatSideBarLinks(sidebar: SidebarGroup[]): MenuItemWithLink[] {
      const links: MenuItemWithLink[] = [];
      for (const group of sidebar) {
        for (const link of group.items) {
          links.push(link);
        }
      }
      return links;
    }
    return {
      page,
      theme,
      links,
      isActive,
      normalizeLink,
    };
  },
});
</script>

<template>
  <footer v-if="links.prev || links.next" class="VPContentDocFooter">
    <a
      v-if="links.prev"
      class="prev-link"
      :href="normalizeLink(links.prev.link)"
    >
      <span class="desc"
        ><VCVIconChevronLeft class="vt-link-icon" /> Previous</span
      >
      <span class="title">{{ links.prev.text }} </span>
    </a>
    <a
      v-if="links.next"
      class="next-link"
      :href="normalizeLink(links.next.link)"
    >
      <span class="desc"
        >Next <VCVIconChevronRight class="vt-link-icon"
      /></span>
      <span class="title">{{ links.next.text }}</span>
    </a>
  </footer>
</template>

<style scoped>
.VPContentDocFooter {
  border-top: 1px solid var(--vt-c-divider-light);
  padding-top: 1rem;
  display: flex;
  justify-content: space-between;
}

a {
  display: inline-block;
  font-weight: 500;
  font-size: 16px;
  max-width: 48%;
}

.desc {
  font-size: 11px;
  color: var(--vt-c-text-2);
  display: block;
}

.title {
  color: var(--vt-c-brand);
  transition: color 0.25s;
}

a:hover .title {
  color: var(--vt-c-brand-highlight);
}

.next-link {
  margin-left: auto;
  text-align: right;
}

.vt-link-icon {
  margin: -2px 0 0;
  vertical-align: middle;
}
</style>
